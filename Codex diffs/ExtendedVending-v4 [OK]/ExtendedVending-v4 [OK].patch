diff --git a/Codex diffs/ExtendedVending-v4 [OK]/README.md b/Codex diffs/ExtendedVending-v4 [OK]/README.md
index 34a3491..af299de 100644
--- a/Codex diffs/ExtendedVending-v4 [OK]/README.md	
+++ b/Codex diffs/ExtendedVending-v4 [OK]/README.md	
@@ -19,10 +19,15 @@ Header:
 
 Body:
   - Item: Zeny
+    DisplayItem: 1750
+    DisplayName: "Zeny"
     StorePrefix: "[Z]"
 
   # - Item: Hydra_Card
+  #   DisplayAegisName: Hydra_Card
+  #   DisplayName: "Hydra"
   #   StorePrefix: "[HYDRA]"
 
 # Item/AegisName entries are matched case-insensitively.
+# DisplayItem/DisplayAegisName controls icon/name shown by the selection window.
 ```
diff --git a/DIFFS_IMPLEMENTATION_REPORT.md b/DIFFS_IMPLEMENTATION_REPORT.md
index 2c736c5..64f9425 100644
--- a/DIFFS_IMPLEMENTATION_REPORT.md
+++ b/DIFFS_IMPLEMENTATION_REPORT.md
@@ -162,3 +162,21 @@ Body:
 | `cmake --build build --target map-server -j$(nproc)` | **PASS** | `Built target map-server` after vending cancel/menu/rendering fixes. | `src/map/vending.cpp`, `src/custom/defines_pre.hpp` |
 | `ctest --test-dir build --output-on-failure` | **PASS** (no tests) | `No tests were found!!!` | Test harness discovery |
 | `timeout 20s ./map-server --run-once` | **FAIL** (env/deps) | Missing `conf/import/*`, missing custom NPC files, MySQL unavailable. | Runtime environment prerequisites |
+
+## Hotfix 3: party HP/SP packet compatibility + vending display mapping
+
+### Changes
+- Reverted default party HP packet structs to upstream-compatible guards (SP fields only on ZERO branch), then added an auxiliary `0x0bab` SP-capable packet send alongside normal HP updates when `party_sp_on` is enabled. This preserves HP-bar compatibility while attempting SP updates for clients that support `0x0bab`.
+- Extended vending currency entries now support display mapping keys:
+  - `DisplayItem` (numeric item id)
+  - `DisplayAegisName` (case-insensitive)
+  - `DisplayName` (metadata label)
+- Currency menu rendering now uses mapped display item ids, and selection maps display ids back to internal currency ids; this removes the hardcoded-apple behavior and allows zeny/icon customization through YAML.
+
+### Command results
+
+| Command | Result | Concise excerpt | Impacted module(s) |
+|---|---|---|---|
+| `cmake --build build --target map-server -j$(nproc)` | **PASS** | `Built target map-server` after party-packet and vending-display mapping changes. | `src/map/clif.cpp`, `src/map/packets_struct.hpp`, `src/map/vending.cpp` |
+| `ctest --test-dir build --output-on-failure` | **PASS** (no tests) | `No tests were found!!!` | Test harness discovery |
+| `timeout 20s ./map-server --run-once` | **FAIL** (env/deps) | Missing `conf/import/*`, missing custom NPC files, MySQL unavailable. | Runtime environment prerequisites |
diff --git a/db/import-tmpl/item_db_extended_vending.yml b/db/import-tmpl/item_db_extended_vending.yml
index 3c088ab..697a6dd 100644
--- a/db/import-tmpl/item_db_extended_vending.yml
+++ b/db/import-tmpl/item_db_extended_vending.yml
@@ -7,6 +7,9 @@
 # - Item: Item AegisName used as vending currency (e.g. Hydra_Card).
 #         AegisName matching is case-insensitive.
 # - Id: Alternative numeric item id. Use 0 or Item: Zeny for zeny shops.
+# - DisplayItem: Optional client item id used for menu icon/name display.
+# - DisplayAegisName: Optional alternative to DisplayItem (case-insensitive).
+# - DisplayName: Optional custom text label (server-side metadata).
 # - StorePrefix: Prefix injected before the opened shop name.
 
 Header:
@@ -16,8 +19,12 @@ Header:
 Body:
   # Zeny example
   - Item: Zeny
+    DisplayItem: 1750
+    DisplayName: "Zeny"
     StorePrefix: "[Z]"
 
   # Item currency example
   # - Item: Hydra_Card
+  #   DisplayAegisName: Hydra_Card
+  #   DisplayName: "Hydra"
   #   StorePrefix: "[HYDRA]"
diff --git a/db/import/item_db_extended_vending.yml b/db/import/item_db_extended_vending.yml
index 3c088ab..697a6dd 100644
--- a/db/import/item_db_extended_vending.yml
+++ b/db/import/item_db_extended_vending.yml
@@ -7,6 +7,9 @@
 # - Item: Item AegisName used as vending currency (e.g. Hydra_Card).
 #         AegisName matching is case-insensitive.
 # - Id: Alternative numeric item id. Use 0 or Item: Zeny for zeny shops.
+# - DisplayItem: Optional client item id used for menu icon/name display.
+# - DisplayAegisName: Optional alternative to DisplayItem (case-insensitive).
+# - DisplayName: Optional custom text label (server-side metadata).
 # - StorePrefix: Prefix injected before the opened shop name.
 
 Header:
@@ -16,8 +19,12 @@ Header:
 Body:
   # Zeny example
   - Item: Zeny
+    DisplayItem: 1750
+    DisplayName: "Zeny"
     StorePrefix: "[Z]"
 
   # Item currency example
   # - Item: Hydra_Card
+  #   DisplayAegisName: Hydra_Card
+  #   DisplayName: "Hydra"
   #   StorePrefix: "[HYDRA]"
diff --git a/src/map/clif.cpp b/src/map/clif.cpp
index 45d5125..50dcb0d 100644
--- a/src/map/clif.cpp
+++ b/src/map/clif.cpp
@@ -8250,13 +8250,33 @@ void clif_party_hp( const map_session_data& sd ){
 #else
 	p.hp = sd.battle_status.hp;
 	p.maxhp = sd.battle_status.max_hp;
-#if PACKETVER_ZERO_NUM >= 20210504 || PACKETVER_MAIN_NUM >= 20210526 || PACKETVER_RE_NUM >= 20211103
+#if PACKETVER_ZERO_NUM >= 20210504
 	p.sp = battle_config.party_sp_on ? sd.battle_status.sp : 0;
 	p.maxsp = battle_config.party_sp_on ? sd.battle_status.max_sp : 0;
 #endif
 #endif
 
 	clif_send( &p, sizeof( p ), &sd, battle_config.party_sp_on ? PARTY : PARTY_AREA_WOS );
+
+	if( battle_config.party_sp_on ) {
+		struct PACKET_ZC_NOTIFY_HP_TO_GROUPM_SP {
+			int16 PacketType;
+			uint32 AID;
+			int hp;
+			int maxhp;
+			int sp;
+			int maxsp;
+		} __attribute__((packed));
+
+		PACKET_ZC_NOTIFY_HP_TO_GROUPM_SP ps{};
+		ps.PacketType = 0x0bab;
+		ps.AID = sd.status.account_id;
+		ps.hp = sd.battle_status.hp;
+		ps.maxhp = sd.battle_status.max_hp;
+		ps.sp = sd.battle_status.sp;
+		ps.maxsp = sd.battle_status.max_sp;
+		clif_send(&ps, sizeof(ps), &sd, PARTY);
+	}
 }
 
 /// Notifies the party members of a character's death or revival.
@@ -8308,13 +8328,33 @@ void clif_hpmeter_single( const map_session_data& sd, uint32 id, uint32 hp, uint
 #else
 	p.hp = hp;
 	p.maxhp = maxhp;
-#if PACKETVER_ZERO_NUM >= 20210504 || PACKETVER_MAIN_NUM >= 20210526 || PACKETVER_RE_NUM >= 20211103
+#if PACKETVER_ZERO_NUM >= 20210504
 	p.sp = battle_config.party_sp_on ? sp : 0;
 	p.maxsp = battle_config.party_sp_on ? maxsp : 0;
 #endif
 #endif
 
 	clif_send( &p, sizeof( p ), &sd, SELF );
+
+	if( battle_config.party_sp_on ) {
+		struct PACKET_ZC_NOTIFY_HP_TO_GROUPM_SP {
+			int16 PacketType;
+			uint32 AID;
+			int hp;
+			int maxhp;
+			int sp;
+			int maxsp;
+		} __attribute__((packed));
+
+		PACKET_ZC_NOTIFY_HP_TO_GROUPM_SP ps{};
+		ps.PacketType = 0x0bab;
+		ps.AID = id;
+		ps.hp = hp;
+		ps.maxhp = maxhp;
+		ps.sp = sp;
+		ps.maxsp = maxsp;
+		clif_send(&ps, sizeof(ps), &sd, SELF);
+	}
 }
 
 
diff --git a/src/map/packets_struct.hpp b/src/map/packets_struct.hpp
index 210cce7..52d1555 100644
--- a/src/map/packets_struct.hpp
+++ b/src/map/packets_struct.hpp
@@ -5117,7 +5117,7 @@ struct PACKET_ZC_NOTIFY_POSITION_TO_GROUPM {
 } __attribute__((packed));
 DEFINE_PACKET_HEADER(ZC_NOTIFY_POSITION_TO_GROUPM, 0x0107);
 
-#if PACKETVER_ZERO_NUM >= 20210504 || PACKETVER_MAIN_NUM >= 20210526 || PACKETVER_RE_NUM >= 20211103
+#if PACKETVER_ZERO_NUM >= 20210504
 struct PACKET_ZC_NOTIFY_HP_TO_GROUPM {
 	int16 PacketType;
 	uint32 AID;
@@ -5184,7 +5184,7 @@ struct PACKET_ZC_ACK_TAKEOFF_EQUIP_ALL {
 DEFINE_PACKET_HEADER(ZC_ACK_TAKEOFF_EQUIP_ALL, 0x0bae);
 #endif  // PACKETVER_MAIN_NUM >= 20210818 || PACKETVER_RE_NUM >= 20211103 || PACKETVER_ZERO_NUM >= 20221024
 
-#if PACKETVER_ZERO_NUM >= 20210504 || PACKETVER_MAIN_NUM >= 20210526 || PACKETVER_RE_NUM >= 20211103
+#if PACKETVER_ZERO_NUM >= 20210504
 struct PACKET_ZC_BATTLEFIELD_NOTIFY_HP {
 	int16 PacketType;
 	uint32 AID;
diff --git a/src/map/vending.cpp b/src/map/vending.cpp
index add5456..610be37 100644
--- a/src/map/vending.cpp
+++ b/src/map/vending.cpp
@@ -83,7 +83,33 @@ uint64 ExtendedVendingDatabase::parseBodyNode(const ryml::NodeRef& node)
 	if( !exists ){
 		entry = std::make_shared<s_extended_vending_currency>();
 		entry->nameid = nameid;
+		entry->displayNameid = nameid;
 		entry->storePrefix = (nameid == 0 ? "[Z]" : "");
+		entry->displayName = (nameid == 0 ? "Zeny" : "");
+	}
+
+	if( this->nodeExists(node, "DisplayName") ){
+		if( !this->asString(node, "DisplayName", entry->displayName) ){
+			return 0;
+		}
+	}
+
+	if( this->nodeExists(node, "DisplayItem") ){
+		if( !this->asUInt32(node, "DisplayItem", entry->displayNameid) ){
+			return 0;
+		}
+	}else if( this->nodeExists(node, "DisplayAegisName") ){
+		std::string display_name;
+		if( !this->asString(node, "DisplayAegisName", display_name) ){
+			return 0;
+		}
+
+		std::shared_ptr<item_data> display_item = item_db.search_aegisname(display_name.c_str());
+		if( display_item == nullptr ){
+			this->invalidWarning(node, "Unknown DisplayAegisName '%s', skipping.\\n", display_name.c_str());
+			return 0;
+		}
+		entry->displayNameid = display_item->nameid;
 	}
 
 	if( this->nodeExists(node, "StorePrefix") ){
@@ -260,7 +286,9 @@ void vending_openvendingreq(map_session_data& sd, uint16 skill_lv)
 	std::sort(currencies.begin(), currencies.end());
 
 	for( t_itemid nameid : currencies ) {
-		auto out_nameid = static_cast<decltype(packet->items[0].itemId)>(nameid == 0 ? UNKNOWN_ITEM_ID : nameid);
+		auto currency = extended_vending_db.find(nameid);
+		t_itemid display_nameid = currency != nullptr ? currency->displayNameid : nameid;
+		auto out_nameid = static_cast<decltype(packet->items[0].itemId)>(display_nameid > 0 ? display_nameid : UNKNOWN_ITEM_ID);
 		packet->items[count++].itemId = out_nameid;
 		packet->packetLength += sizeof(packet->items[0]);
 	}
@@ -278,20 +306,25 @@ void vending_openvendingreq(map_session_data& sd, uint16 skill_lv)
 
 void vending_select_currency(map_session_data& sd, t_itemid nameid)
 {
-	bool selected_zeny = false;
-	if( nameid == UNKNOWN_ITEM_ID && extended_vending_db.find(0) != nullptr ){
-		nameid = 0;
-		selected_zeny = true;
+	t_itemid currency_id = nameid;
+	if( extended_vending_db.find(currency_id) == nullptr ){
+		currency_id = 0;
+		for( const auto& [id, currency] : extended_vending_db ){
+			if( currency != nullptr && currency->displayNameid == nameid ){
+				currency_id = id;
+				break;
+			}
+		}
 	}
 
-	if( nameid == 0 && !selected_zeny ){
+	if( currency_id == 0 && extended_vending_db.find(0) == nullptr ){
 		sd.extended_vend.nameid = 0;
 		sd.state.prevend = 0;
 		sd.state.workinprogress = WIP_DISABLE_NONE;
 		return;
 	}
 
-	if (!vending_is_currency_allowed(nameid)) {
+	if (!vending_is_currency_allowed(currency_id)) {
 		sd.extended_vend.nameid = 0;
 		sd.state.prevend = 0;
 		clif_skill_fail(sd, MC_VENDING);
@@ -299,7 +332,7 @@ void vending_select_currency(map_session_data& sd, t_itemid nameid)
 		return;
 	}
 
-	sd.extended_vend.nameid = nameid;
+	sd.extended_vend.nameid = currency_id;
 	clif_openvendingreq(sd, 2 + sd.extended_vend.level);
 }
 
diff --git a/src/map/vending.hpp b/src/map/vending.hpp
index 86e04b5..faf2a97 100644
--- a/src/map/vending.hpp
+++ b/src/map/vending.hpp
@@ -17,7 +17,9 @@ struct s_autotrader;
 
 struct s_extended_vending_currency {
 	t_itemid nameid;
+	t_itemid displayNameid;
 	std::string storePrefix;
+	std::string displayName;
 };
 
 class ExtendedVendingDatabase : public TypesafeYamlDatabase<t_itemid, s_extended_vending_currency> {
